<!DOCTYPE HTML>
<html>

<head>
    <title>养老管理系统</title>
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <script type="text/javascript" src="js/extLocation.js"></script>
    <script type="text/javascript" src="js/configurationFile.js"></script>
    <script type="text/javascript" src="js/formDisabled.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/mycalendar.js"></script>
    <script type="text/javascript" src="js/commonfuncs/layer/layer.min.js"></script>


    <style type="text/css">
        html, body {
            font: 12px/20px "微软雅黑", "宋体", Arial, sans-serif, Verdana, Tahoma;
            color: black;
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            font-size: 12px;
            font-family: Verdana,Arial,Helvetica,sans-serif;
            background-color: #1671b7;
        }

        #header {
            background-image: url(img/pension03/header.png);
            position: absolute;
            width:100%;
            height: 90px;
            z-index: 9;
        }
        .cs-north-logo {
            height: 60px;
            margin: 5px 0px 0px 5px;
            /*margin: 25px 0px 0px 5px;*/
            display: inline-block;
            color: #000000;
            font-size: 22px;
            font-weight: bold;
            text-decoration: none;
            background: url(img/pension03/log.png) no-repeat;
            width: 100%;
        }
        #headnavul {
            float: left;
            padding: 0;
            position: absolute;
            background: url(img/pension03/navbg.png) no-repeat;
            margin-top:-22px;
            margin-left: 500px;
            width: 748px;
            list-style: none outside none;
        }
        #headnavul .li-skinitem {
            float: left;
            font-size: 12px;
            margin-left: 50px;
            margin-bottom: 0px;
            line-height: 30px;
            height: 30px;
            text-align: center;
            padding: 0;
        }
        #headnavul .li-skinitem a {
            cursor:pointer;
            padding-left: 30px;
            display: block;
            height: 30px;
            line-height: 30px;
            margin-top: 0;
            margin-bottom: 0;
        }



        .clear{
            clear: both;
        }

        .separate{
            color:#808080;
        }

        /******************自定义左边栏********************************/

        #menu_newpension{
            padding-top: 30px;
        }
        #menu_newpension ul,#menu_newpension li{
            margin:0; padding:0; list-sytle:none;
            display: block;/*此处设置很重要*/
        }


        li.jianju{
            height: 15px;
        }
        li.menulevelone{
            font-size: 14px;
            font-weight: bolder;
            height: 40px;
            line-height: 40px;
            background: url(img/pension03/menulevelone.png) no-repeat;
        }


        li.menulevelone>a,li.dropdown a{
            text-decoration: none;
            display: block;
            color: #82d0fd;
            padding-left: 50px;
        }
        li.menulevelone>a{
            color: #eeecf7;
        }

        li.dropdown li{
            height: 40px;
            line-height: 46px;
        }
        #menu_newpension .menuselected{
            color: #ffffff;
            font-weight: bolder;
            height: 46px;
            line-height: 46px;
            /*background: url(img/pension03/menuleveltwo.png) no-repeat;*/
            background-color: #A3AAC2;
        }
        #menu_newpension .menulevelone-selected{
            color: #e0b542;
        }
        .menulevelone{
            cursor: pointer;
        }
        li.dropdown a.dropdown-li-a-hover{
            color: #e0b542;
            cursor: pointer;
        }


        #current-user-msg{
            margin-top: -10px;
            font-size: 12px;
            height: 35px;
            line-height: 35px;
            float: right;
            padding: 0;
            padding-right: 10px;
            color: #FFFFFF;
            font-weight: normal;
        }
        #current-user-msg ul{
            list-style: none  none;
            height: 30px;
            line-height: 30px;
        }
        #current-user-msg li{
            float: left;
            padding-left: 20px;
            text-align: center;
        }
        #current-user-msg li a{
            cursor:pointer;
            padding-left: 25px;
            display: block;

        }
        #logout{
            color: #ffffff;
            text-decoration:none;
        }

        .hight-color{
            color: #ffa500;
        }
        .hight-color-2{
            color: #008000;
        }

        .indexbackground_2{
            background: url(img/pension02/bodybackground.jpg) center;
        }

    </style>

</head>
<body>
<div id="header">
    <div class="cs-north-logo">
        <!--<span >
            <label style="font-size: 40px;color:white;height:30px;padding-bottom: 30px;">平湖市养老管理信息系统</label>
        </span>-->
        <div id="current-user-msg" >
            <ul>
                <li><a>欢迎您:<span id="myusername">{{username}}</span></a></li>
                <li><a id="currentDate" style="background: url(img/pension03/currentDate.png) center no-repeat;width: 309px;text-align: center;padding-left: 5px;">2014年11月29日 星期六 农历甲午年 十月初八</a></li>
                <li class="li-skinitem">
                    <a style="background: url(img/pension03/resetpassword.png) no-repeat;">修改密码</a></li>
                <li class="li-skinitem">
                    <a id="logout" style="background: url(img/pension03/fanhui.png) no-repeat;" href="logout">退出</a></li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>

    <ul id="headnavul">
        <li class="li-skinitem" style="margin-left: 60px;">
            <a opt="a9DTN0LmDWT0eGTZc4St" style="background: url(img/pension03/icon_shujuku.png)  no-repeat;cursor:pointer">数据库</a>
        </li>
        <li class="li-skinitem" style="margin-left: 30px;">
            <a opt="bR8kBGp0A6lTmPkgOFxI" style="background: url(img/pension03/icon_pinggu.png) no-repeat;">服务评估</a>
        </li>
        <li class="li-skinitem" style="margin-left: 30px;">
            <a opt="0a93c53c4f6d476e9a2a7383691a3c37" style="background: url(img/pension03/icon_pinggu.png) no-repeat;">住院补助</a>
        </li>
        <li class="li-skinitem" style="margin-left: 30px;">
            <a opt="6NOpHUzyXoUhObvUHHNr" style="background: url(img/pension03/icon_yanglaojigou.png) no-repeat">养老机构</a>
        </li>
        <li class="li-skinitem" style="margin-left: 30px;">
            <a opt="KqYaHUodlGekYv9sanhD" style="background: url(img/pension03/icon_zijinfafang.png) no-repeat;cursor:pointer">资金发放</a>
        </li>
        <li class="li-skinitem" style="margin-left: 30px;">
            <a opt="closeAllTabs" style="background: url(img/pension03/icon_guanbi.png) no-repeat;cursor:pointer">关闭</a>
        </li>
    </ul>
</div>
<div class="easyui-layout" data-options="fit:true,border:false">
    <div data-options="region:'north',border:false" style="height:91px;padding:0;background-color: #1671b7;">
    </div>
    <div region="west" id="westpanel" border="false" split="true"  class="cs-west"
         style="background-color: #1671b7;"
         collapsible="false">
        <div id="menu_newpension" fit="true" border="false">
            <ul class="leftul">
            </ul>
        </div>
    </div>
    <div id="mainPanle" region="center" border="false">
        <div id="tabs" class="easyui-tabs"   fit="true" border="false" >
            <div title="主页" class="indexbackground_2">
                <div class="cs-home-remark">
                    <h3 style="font-family: 'courier new'">

                    </h3>

                </div>
            </div>
        </div>
    </div>
</div>

<div id="mymenuone" style="display: none">{{menuone}}</div>
<div id="mymenutwo" style="display: none">{{menutwo}}</div>
<div id="usermsg" style="display: none">{{usermsg}}</div>
</body>
</html>
<script>

    document.write('<link rel="stylesheet" type="text/css" id="swicth-style" href="'+extEasyui+
            'themes/default/easyui.css"><\/>');
    document.write('<script type="text/javascript"  src="'+extEasyui+
            'jquery.easyui.min.js"><\/script>');
    document.write('<script type="text/javascript"  src="'+extEasyui+
            'locale/easyui-lang-zh_CN.js"><\/script>');


</script>
<script>
    var usermsg;
    $(function(){
        usermsg=$.evalJSON($('#usermsg').text());
    })
    var customMenuRoot = '{{functionid}}';
    var swapFunction;
    var mymenudata=[];
    var needClick=[];
    var leftMenuClick=function(v){
        needClick.push(v);
    };
    var swapFunction=function(){};
    var getMenudata=function(functionid){
        for(var i in mymenudata) {
            if(mymenudata[i].functionid==functionid) {
                return mymenudata[i];
            }
        }
    };
    var setMenuData=function(functionid,menuone,menutwo) {
        var data=getMenudata(functionid);
        if(!data){
            mymenudata.push({
                functionid:functionid,
                menuone: $.isArray(menuone)?menuone[0]:menuone,
                menutwo:menutwo
            })
        }else if(!data.menutwo){
            data.menutwo = menutwo;
        }
    };
    $(function(){
        if(!mymenudata.length) {
            setMenuData(customMenuRoot, $.evalJSON($('#mymenuone').text()), $.evalJSON($('#mymenutwo').text()));
        }


        var genMenulevelonehtml=function(nodes){
            var mynodes=nodes;
            if(!$.isArray(nodes)){
                mynodes = [nodes];
            }

            var result=$('<ul></ul>');

            for(var i=0;i<mynodes.length;i++){
                var node = mynodes[i];
                if(!node){
                    continue;
                }
                var $li=$('<li class="leftli"> <ul> <li class="menulevelone"><a >'+node.title+'<span></span></a></li> <li class="dropdown"> </li> </ul> </li>')
                $li.find('li.menulevelone a').data("greeting",node );
                result.append($li);
                result.append('<li class="jianju"></li>');
            }
            return result;
        };

        var genMenuleveltwohtml=function(nodes){
            var resutl=$('<ul></ul>');
            for(var i=0;i<nodes.length;i++){
                var node = nodes[i];
                var $li=$('<li><a  opt="1">'+node.title+'</a></li>');
                $li.data("greeting",node );
                resutl.append($li);
            }
            return resutl;
        };


        var setMenuLevelTwoClickEvent=function($dropdownas){
            ddd =$dropdownas
            console.log(1)
            //var $dropdownas=$('#menu_newpension li.dropdown a');
            var flag = 0;
            $dropdownas.click(function(e){
                flag+=1;
                console.log("flag:"+flag)
                var me = $(this);
                var $li = $(this).parent();
                $dropdownas.each(function(){
                    $(this).removeClass('menuselected')
                            .parents('.dropdown').prev().find('a').removeClass('menulevelone-selected');
                });
                $(this).addClass('menuselected').parents('.dropdown').prev().find('a').addClass('menulevelone-selected');
                leftMenuClick($li);
                if(me.text() == "签到页面"){
                    $.ajax({
                        url:'depart/getopdsigin',
                        type:'post',
                        data:{
                            page:1,
                            rows:15
                        },
                        success:function(data){
                            var nosignp = new Array();
                            var rows = data.rows;
                            for(var r=0;r<rows.length;r++){
                                if(rows[r].warn == "1"){
                                    nosignp.push(rows[r].name)
                                }
                            }
                            if(nosignp.length > 0){
                                var dlg;
//                                if(flag == 1){
                                    dlg = $.messager.show({
                                        title:'温馨提示',
                                        msg:'<div style="width:400px;height: 10px;"><marquee direction=left behavior=scroll onmouseover=this.stop() onmouseout=this.start()><label style="color: red;">【'+nosignp+'】未签到</label></marquee></div>',
                                        timeout:false,
                                        showType:'show',
                                        width:'400px',
                                        height:'20px'
                                    });
//                                }
                                dd = dlg;
                            }
                            console.log(cj.getUserMsg())
                        }
                    })
                }
            }).hover(function(e){
                $dropdownas.removeClass('dropdown-li-a-hover');
                $(this).addClass('dropdown-li-a-hover')
            },function(e){
                $dropdownas.removeClass('dropdown-li-a-hover');
            });
        }


        var addMenuDataTwo=function(menutwo,e){
            var two=genMenuleveltwohtml(menutwo);
            var dropDown = $me.parent().next();
            dropDown.append(two);
            $('.dropdown').not(dropDown).slideUp('slow');
            //dropDown.slideToggle('slow');
            setMenuLevelTwoClickEvent($(two).find('a'));
            e.preventDefault();
        }

        function addAccordion(functionid) {


            var menudata={};
            if(functionid) {
                menudata = getMenudata(functionid);
            }else{
                menudata = mymenudata[0];
            }
            var getAccordion = function (mydata) {
                var menudata=mydata;
                //菜单切换
                $('#menu_newpension ul').html('');
                var one=genMenulevelonehtml(menudata.menuone);
                $('#menu_newpension .leftul').append(one);
                $('#menu_newpension li.menulevelone a').click(function (e) {
                    $me = $(this);
                    $me.data('idClicked',true);

                    //getMenudata
                    if(!$me.data('loadChildren')){
                        $me.data('loadChildren', true);
                        if(menudata.menutwo){
                            addMenuDataTwo(menudata.menutwo,e);
                        }else{
                            $.ajax(
                                    {
                                        url:'menutree',
                                        data:{
                                            node:$me.data('greeting').functionid
                                        },
                                        success:function(res){
                                            setMenuData(functionid, menudata.menuone, res);
                                            addMenuDataTwo(res,e);

                                        }
                                    }
                            )
                        }

                    }else{
                        var dropDown = $me.parent().next();
                        $('.dropdown').not(dropDown).slideUp('slow');
                        if(!$me.data('isClicked')){
                            dropDown.slideToggle('slow');
                        }
                        e.preventDefault();
                    }
                });
                $('#menu_newpension li.menulevelone a').first().trigger('click');

            }


            //加载抽屉
            var ajaxOption;
            var mysuccess=function(res){
                setMenuData(functionid, res);
                getAccordion(getMenudata(functionid));
            };
            if(functionid){
                ajaxOption={
                    url:'getFunctionById',//只加载一个目录
                    data:{node:functionid},
                    success:mysuccess
                }
            }else{
                ajaxOption={
                    url:'menutree',
                    data:{node:'dasffffffffffffffdsdsfs'},//养老
                    success:mysuccess
                }
            }
            if(menudata){
                getAccordion(menudata);
            }else{
                $.ajax(ajaxOption);
            }

        }

        addAccordion();

        swapFunction=addAccordion;
    })
</script>



<link rel="Stylesheet" type="text/css" href="img/css/home.css">
<script type="text/javascript" src="js/commonfuncs/jquery.json-2.4.js"></script>
<script type="text/javascript" src="js/require.js" data-main="js/mainapp_newpension"></script>
<script type="text/javascript" src="js/jqueryplugin/jquery.iframe-auto-height.plugin.1.9.5.min.js"></script>

<script src="js/urls.js"></script>
<script src="js/cj.js"></script>
<script type="text/javascript">

    $(document).keyup(function(event){//弹出层注册ESC按键事件
        switch(event.keyCode) {
            case 27:
                $('.webox').parent('div[id]').last().trigger('close');

        }
    });


    /*window.setTimeout(function () {
        $('#mainPanle').addClass('my-mainPanel');
    }, 300);*/



    $('#currentDate').text(mycalendar.RunGLNL());
    $('#headnavul a').bind('click',function(){
        $('#current-user-msg a,#headnavul a').removeClass('hight-color');
        $(this).addClass('hight-color');
        if($($(this)[0]).attr('opt') == "closeAllTabs"){
            /*关闭页签*/
            $(".tabs li").each(function(index, obj) {
                //获取所有可关闭的选项卡
                var tab = $(".tabs-closable", this).text();
                $(".easyui-tabs").tabs('close', tab);
            });
        }else{
            swapFunction($(this).attr('opt'));
            /*养老机构*/
            if($($(this)[0]).attr('opt') == "6NOpHUzyXoUhObvUHHNr"){
                /*$.ajax({
                    url:'depart/getopdsigin',
                    type:'post',
                    data:{
                        page:1,
                        rows:15
                    },
                    success:function(data){
                        var nosignp = new Array();
                        var rows = data.rows;
                        for(var r=0;r<rows.length;r++){
                            if(rows[r].warn == "1"){
                                nosignp.push(rows[r].name)
                            }
                        }
                        $.messager.show({
                            title:'温馨提示',
                            msg:'<div style="width:700px;height: 10px;"><marquee direction=left behavior=scroll onmouseover=this.stop() onmouseout=this.start()><label style="color: red;">【'+nosignp+'】未签到</label></marquee></div>',
                            timeout:false,
                            showType:'show',
                            width:'700px',
                            height:'20px'
                        });
                        console.log(cj.getUserMsg())
                    }
                })*/

            }
        }
    });
    $('#current-user-msg a,#headnavul a').hover(function(){
        $('#current-user-msg a,#headnavul a').removeClass('hight-color-2');
        $(this).addClass('hight-color-2');
    },function(){
        $(this).removeClass('hight-color-2');
    })

    $(function(){
        $('#mainPanle').addClass('my-mainPanel');
    })
    //本来在route中的代码
</script>
<script type="text/javascript" src="js/highcharts/highcharts.js"></script>
<script type="text/javascript" src="js/highcharts/exporting.js"></script>
<script type="text/javascript" src="js/highcharts/setOptions.js"></script>
